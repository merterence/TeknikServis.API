@model List<TeknikServis.UI.Models.dto.ServisTalebiDto>

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Teknik Servis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">

    <h2>Teknik Servis Talebi</h2>

    <button class="btn btn-primary" onclick="showForm()">Servis Talebi Oluştur</button>

    <div id="talepForm" style="display: none; margin-top: 20px;">
        <form id="servisTalepForm">
            <div class="mb-3">
                <label for="urunAdi" class="form-label">Ürün Adı</label>
                <input type="text" class="form-control" id="urunAdi" required>
            </div>

            <div class="mb-3">
                <label for="aciklama" class="form-label">Açıklama</label>
                <textarea class="form-control" id="aciklama" required></textarea>
            </div>

            <div class="mb-3">
                <label for="kullaniciAdi" class="form-label">Adınız</label>
                <input type="text" class="form-control" id="kullaniciAdi" required>
            </div>

            <div class="mb-3">
                <label for="resim" class="form-label">Fotoğraf Yükleyin</label>
                <input type="file" class="form-control" id="resim">
            </div>

            <button type="button" class="btn btn-success" onclick="gonder()">Gönder</button>
        </form>
    </div>

    <hr class="mt-5" />
    <h3>Gönderilen Servis Talepleri</h3>

    <table class="table table-bordered mt-3">
        <thead>
            <tr>
                <th>Ad Soyad</th>
                <th>Ürün</th>
                <th>Açıklama</th>
                <th>Durum</th>
                <th>Adres</th>
                <th>Sil</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var talep in Model)
            {
                <tr>
                    <td>@talep.KullaniciAdi</td>
                    <td>@talep.UrunAdi</td>
                    <td>@talep.Aciklama</td>
                    <td>@talep.TalepDurumu</td>
                    <td>@talep.Adres</td>
                    <td>
                        <form asp-controller="ServisTalebi" asp-action="Sil" method="post">
                            <input type="hidden" name="id" value="@talep.Id" />
                            <button type="submit" class="btn btn-danger btn-sm">Sil</button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <script>
        function showForm() {
            document.getElementById("talepForm").style.display = "block";
        }

        async function gonder() {
            const urunAdi = document.getElementById("urunAdi").value;
            const aciklama = document.getElementById("aciklama").value;
            const kullaniciAdi = document.getElementById("kullaniciAdi").value;

            const veri = {
                urunAdi: urunAdi,
                aciklama: aciklama,
                kullaniciAdi: kullaniciAdi
            };

            try {
                const response = await fetch("https://localhost:44365/api/ServisTalebi", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(veri)
                });

                if (response.ok) {
                    alert("Servis talebiniz başarıyla alındı!");
                    document.getElementById("servisTalepForm").reset();
                    location.reload(); // Yeni kayıt sonrası sayfayı yenile
                } else {
                    alert("Bir hata oluştu!");
                }
            } catch (error) {
                alert("Bağlantı hatası: " + error);
            }
        }
    </script>

</body>
</html>
 